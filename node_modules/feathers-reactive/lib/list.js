'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (Rx, events, options) {
  return function () {
    var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

    var query = Object.assign({}, params.query);
    var result = this._super.apply(this, arguments);
    var args = arguments;

    // Hack because feathers-query-params deletes stuff from `params.query`
    // Will be fixed in the next version
    params.query = query;

    if (this._rx === false || params.rx === false || typeof result.then !== 'function') {
      return result;
    }

    options = Object.assign(options, this._rx, params.rx);

    var source = Rx.Observable.fromPromise(result);

    return (0, _utils.promisify)(options.listStrategy.call(this, source, events, options, args), result);
  };
};

var _utils = require('./utils');

module.exports = exports['default'];